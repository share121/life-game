import{d as e,s as a,S as t,T as n,V as r,W as s,r as o,X as u,Y as i,Z as l,_ as c,$ as f,t as d,F as y,a0 as p,b as v,n as x,a1 as m,o as h,a2 as N,a3 as S,a4 as g}from"../../vendor-484ee752.js";import{u as k}from"../stores/config-89012d71.js";import{u as w}from"../stores/temp-9afe39cf.js";const b=["data-x","data-y","onClick"],T=e({__name:"HomeView",setup(e){const{col:T,row:J,divSize:O,updateSpeed:q,enabledTransition:C}=a(k()),{isStart:E,isLocked:F}=a(w());let _=t([]);function j(e,a){return _.find((t=>t.x===e&&t.y===a))}function A(e,a,t=!j(e,a)){!!j(e,a)?t||_.splice(function(e,a){return _.findIndex((t=>t.x===e&&t.y===a))}(e,a),1):t&&_.push({x:e,y:a})}const{workerFn:I}=n((e=>{const a=JSON.parse(e);function*t(...e){if(1===e.length)for(const a of e[0])yield[a];else{const a=[],n=e[0][0];for(const r of t(...e.slice(1)))a.push(r),yield[n,...r];for(const t of e[0].slice(1))for(const e of a)yield[t,...e]}}function n(e,a,t){return r(a,t).map((({x:a,y:t})=>function(a,t){return e.find((e=>e.x===a&&e.y===t))}(a,t)))}function r(e,a){return[...t([-1,0,1],[-1,0,1])].filter((([e,a])=>!(0===e&&0===a))).map((([t,n])=>({x:e+t,y:a+n})))}const s=[],o=[];var u;return a.forEach((({x:e,y:a})=>{[{x:e,y:a},...r(e,a)].forEach((e=>{o.push(e)}))})),(u=o,u.filter(((e,a,t)=>t.findIndex((a=>{return t=e,n=a,JSON.stringify(t)===JSON.stringify(n);var t,n}))===a))).forEach((({x:e,y:t})=>{const r=function(e,t){return a.find((a=>a.x===e&&a.y===t))}(e,t);switch(n(a,e,t).reduce(((e,a)=>e+ +!!a),0)){case 2:break;case 3:r||s.push({x:e,y:t});break;default:r&&s.push({x:e,y:t})}})),JSON.stringify(s)}));function L(e,a,t=1){return Array(Number((a-e)/t)).fill(e).map(((e,a)=>e+a*t))}r(E,(()=>{if(!E.value)return;let e=performance.now();requestAnimationFrame((async function a(t){E.value&&(t-e>=q.value&&(e=t,JSON.parse(await I(JSON.stringify(_))).forEach((({x:e,y:a})=>{A(e,a)}))),requestAnimationFrame(a))}))}));const V=s((()=>{let e=_.reduce(((e,a)=>a.y>e?a.y:e),J.value-1)+1;return L(_.reduce(((e,a)=>a.y<e?a.y:e),0),e)})),$=s((()=>{let e=_.reduce(((e,a)=>a.x>e?a.x:e),T.value-1)+1;return L(_.reduce(((e,a)=>a.x<e?a.x:e),0),e)}));r((()=>_.reduce(((e,a)=>a.y<e?a.y:e),0)),(async(e,a)=>{let t=document.querySelector("main");t&&e!==a&&0===t.scrollTop&&(await S(),t.scrollTop+=(O.value+8)*(a-e))})),r((()=>_.reduce(((e,a)=>a.x<e?a.x:e),0)),((e,a)=>{let t=document.querySelector("main");t&&e!==a&&(t.scrollLeft+=(O.value+8)*(a-e))}));const z=o(!1),{x:H,y:W}=u({type:"page"}),{element:X}=i({x:H,y:W}),{pressed:Y}=l(),{vibrate:Z}=c({pattern:[300,100,300]}),B=o(!1);function D(e){("mouse"===e.pointerType&&!B.value||"mouse"!==e.pointerType)&&(z.value=!0)}return r(z,(e=>{var a,t;if(e){let e=+(null==(a=X.value)?void 0:a.dataset.x),n=+(null==(t=X.value)?void 0:t.dataset.y);isNaN(e)||isNaN(n)||A(e,n)}Z(),F.value=e})),r(Y,(e=>{e||(B.value=z.value=!1)})),r(X,(()=>{Y.value&&!z.value&&(B.value=!0)})),r(X,(e=>{if(!z.value)return;let a=+(null==e?void 0:e.dataset.x),t=+(null==e?void 0:e.dataset.y);isNaN(a)||isNaN(t)||A(a,t)})),(e,a)=>{const t=g;return f((h(),d("div",{class:"container",style:x({gridTemplateColumns:`repeat(${v($).length}, auto)`,"--width":v(O)+"px","--height":v(O)+"px"}),onContextmenu:a[0]||(a[0]=m((()=>{}),["prevent"]))},[(h(!0),d(y,null,p(v(V),(e=>(h(),d(y,{key:e},[(h(!0),d(y,null,p(v($),(a=>(h(),d("div",{key:a,"data-x":a,"data-y":e,onClick:t=>A(a,e),class:N({true:j(a,e)}),style:x(v(C)?{}:{transition:"none"})},null,14,b)))),128))],64)))),128))],36)),[[t,D]])}}});export{T as _};
