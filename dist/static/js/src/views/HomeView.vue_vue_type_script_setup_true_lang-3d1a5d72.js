import{d as e,s as t,V as n,W as a,X as r,Y as u,r as o,Z as s,_ as l,$ as c,a0 as i,a1 as f,q as y,F as x,a2 as d,a as v,a3 as p,a4 as h,a5 as m,o as g,a6 as S,a7 as w}from"../../vendor-e415ac2b.js";import{u as T}from"../stores/config-dc142c46.js";import{u as k}from"../stores/temp-68e4ff78.js";const J=["data-x","data-y"],N=e({__name:"HomeView",setup(e){const{col:N,row:O,divSize:b,updateSpeed:q,enabledTransition:X}=t(T());let{isStart:Y,isClean:C}=t(k()),E=n([]);function F(e,t){return E.find((n=>n.x===e&&n.y===t))}function _(e,t,n=!F(e,t)){!!F(e,t)?n||E.splice(function(e,t){return E.findIndex((n=>n.x===e&&n.y===t))}(e,t),1):n&&E.push({x:e,y:t})}const{workerFn:j}=a((e=>{const t=JSON.parse(e);function*n(...e){if(1===e.length)for(const t of e[0])yield[t];else{const t=[],a=e[0][0];for(const r of n(...e.slice(1)))t.push(r),yield[a,...r];for(const n of e[0].slice(1))for(const e of t)yield[n,...e]}}function a(e,t,n){return r(t,n).map((({x:t,y:n})=>function(t,n){return e.find((e=>e.x===t&&e.y===n))}(t,n)))}function r(e,t){return[...n([-1,0,1],[-1,0,1])].filter((([e,t])=>0!==e||0!==t)).map((([n,a])=>({x:e+n,y:t+a})))}const u=[],o=[];var s;return t.forEach((({x:e,y:t})=>{[{x:e,y:t},...r(e,t)].forEach((e=>{o.push(e)}))})),(s=o,s.filter(((e,t,n)=>n.findIndex((t=>{return n=e,a=t,JSON.stringify(n)===JSON.stringify(a);var n,a}))===t))).forEach((({x:e,y:n})=>{const r=function(e,n){return t.find((t=>t.x===e&&t.y===n))}(e,n);switch(a(t,e,n).reduce(((e,t)=>e+ +!!t),0)){case 2:break;case 3:r||u.push({x:e,y:n});break;default:r&&u.push({x:e,y:n})}})),JSON.stringify(u)}));function A(e,t){return Array(t-e).fill(e).map(((e,t)=>e+t))}r(Y,(()=>{if(Y.value){let e=performance.now();requestAnimationFrame((async function t(n){Y.value&&(n-e>=q.value&&(e=n,JSON.parse(await j(JSON.stringify(E))).forEach((({x:e,y:t})=>{_(e,t)}))),requestAnimationFrame(t))}))}}));const z=u((()=>{let e=E.reduce(((e,t)=>t.y>e?t.y:e),O.value-1)+1;return A(E.reduce(((e,t)=>t.y<e?t.y:e),0),e)})),D=u((()=>{let e=E.reduce(((e,t)=>t.x>e?t.x:e),N.value-1)+1;return A(E.reduce(((e,t)=>t.x<e?t.x:e),0),e)}));r((()=>E.reduce(((e,t)=>t.y<e?t.y:e),0)),(async(e,t)=>{let n=document.querySelector("main");n&&e!==t&&0===n.scrollTop&&(await S(),n.scrollTop+=(b.value+8)*(t-e))})),r((()=>E.reduce(((e,t)=>t.x<e?t.x:e),0)),((e,t)=>{let n=document.querySelector("main");n&&e!==t&&(n.scrollLeft+=(b.value+8)*(t-e))}));const I=o(!1),{x:V,y:$}=s({type:"client"}),{element:H}=l({x:V,y:$}),{pressed:L}=c(),{vibrate:M}=i({pattern:[300,100,300]}),W=o(!1),Z=o(!1);function B(e){Z.value||W.value&&"mouse"===e.pointerType||(I.value=!0)}function G(e){return!(!e.dataset.x||!e.dataset.y)}function K(e){if(G(e)){return{x:+e.dataset.x,y:+e.dataset.y}}}function P(e){if(e.target&&G(e.target)){const{x:t,y:n}=K(e.target);_(t,n)}}function Q(e,t){const n=e.x-t.x,a=e.y-t.y;return Math.hypot(n,a)}r(I,(e=>{if(e&&H.value&&G(H.value)){let{x:e,y:t}=K(H.value);_(e,t),M()}})),r(L,(()=>{W.value=I.value=!1})),r(H,(()=>{!L.value&&I.value||(W.value=!0)})),r(H,(e=>{if(I.value&&e&&G(e)){let{x:t,y:n}=K(e);_(t,n)}})),r(C,(()=>{C&&(C.value=!1,E.length=0)}));let R={x:0,y:0},U={x:0,y:0};function ee(e){2===e.touches.length&&(Z.value=!0,R.x=e.touches[0].clientX,R.y=e.touches[0].clientY,U.x=e.touches[1].clientX,U.y=e.touches[1].clientY)}function te(e){if(2===e.touches.length){e.preventDefault();let t=(Q({x:e.touches[0].clientX,y:e.touches[0].clientY},{x:e.touches[1].clientX,y:e.touches[1].clientY})-Q(R,U))/200;b.value+=t,b.value<1&&(b.value=1)}else I.value&&e.preventDefault()}return(e,t)=>{const n=w;return f((g(),y("div",{class:p(["container",{transition:v(X),zoom:v(Z)}]),style:h({gridTemplateColumns:`repeat(${v(D).length}, auto)`,"--width":v(b)+"px","--height":v(b)+"px"}),onContextmenu:t[0]||(t[0]=m((()=>{}),["prevent"])),onClick:P,onTouchstart:ee,onTouchmove:te,onTouchend:t[1]||(t[1]=e=>Z.value=!1)},[(g(!0),y(x,null,d(v(z),(e=>(g(),y(x,{key:e},[(g(!0),y(x,null,d(v(D),(t=>(g(),y("div",{key:t,"data-x":t,"data-y":e,class:p({true:F(t,e)})},null,10,J)))),128))],64)))),128))],38)),[[n,B]])}}});export{N as _};
