import{d as e,s as t,W as n,X as a,Y as o,Z as r,r as s,_ as u,$ as c,a0 as i,a1 as l,a2 as y,t as f,F as x,a3 as d,a as v,n as p,a4 as h,o as m,a5 as g,a6 as S,a7 as T}from"../../vendor-8387939e.js";import{u as w}from"../stores/config-b00a7203.js";import{u as k}from"../stores/temp-8d5a4d0e.js";const J=["onTouchstart","onTouchmove"],N=["data-x","data-y"],O=e({__name:"HomeView",setup(e){const{col:O,row:b,divSize:X,updateSpeed:Y,enabledTransition:q}=t(w());let{isStart:C,isLocked:E,isClean:F}=t(k()),_=n([]);function j(e,t){return _.find((n=>n.x===e&&n.y===t))}function A(e,t,n=!j(e,t)){!!j(e,t)?n||_.splice(function(e,t){return _.findIndex((n=>n.x===e&&n.y===t))}(e,t),1):n&&_.push({x:e,y:t})}const{workerFn:I}=a((e=>{const t=JSON.parse(e);function*n(...e){if(1===e.length)for(const t of e[0])yield[t];else{const t=[],a=e[0][0];for(const o of n(...e.slice(1)))t.push(o),yield[a,...o];for(const n of e[0].slice(1))for(const e of t)yield[n,...e]}}function a(e,t,n){return o(t,n).map((({x:t,y:n})=>function(t,n){return e.find((e=>e.x===t&&e.y===n))}(t,n)))}function o(e,t){return[...n([-1,0,1],[-1,0,1])].filter((([e,t])=>0!==e||0!==t)).map((([n,a])=>({x:e+n,y:t+a})))}const r=[],s=[];var u;return t.forEach((({x:e,y:t})=>{[{x:e,y:t},...o(e,t)].forEach((e=>{s.push(e)}))})),(u=s,u.filter(((e,t,n)=>n.findIndex((t=>{return n=e,a=t,JSON.stringify(n)===JSON.stringify(a);var n,a}))===t))).forEach((({x:e,y:n})=>{const o=function(e,n){return t.find((t=>t.x===e&&t.y===n))}(e,n);switch(a(t,e,n).reduce(((e,t)=>e+ +!!t),0)){case 2:break;case 3:o||r.push({x:e,y:n});break;default:o&&r.push({x:e,y:n})}})),JSON.stringify(r)}));function L(e,t){return Array(t-e).fill(e).map(((e,t)=>e+t))}o(C,(()=>{if(C.value){let e=performance.now();requestAnimationFrame((async function t(n){C.value&&(n-e>=Y.value&&(e=n,JSON.parse(await I(JSON.stringify(_))).forEach((({x:e,y:t})=>{A(e,t)}))),requestAnimationFrame(t))}))}}));const $=r((()=>{let e=_.reduce(((e,t)=>t.y>e?t.y:e),b.value-1)+1;return L(_.reduce(((e,t)=>t.y<e?t.y:e),0),e)})),z=r((()=>{let e=_.reduce(((e,t)=>t.x>e?t.x:e),O.value-1)+1;return L(_.reduce(((e,t)=>t.x<e?t.x:e),0),e)}));o((()=>_.reduce(((e,t)=>t.y<e?t.y:e),0)),(async(e,t)=>{let n=document.querySelector("main");n&&e!==t&&0===n.scrollTop&&(await S(),n.scrollTop+=(X.value+8)*(t-e))})),o((()=>_.reduce(((e,t)=>t.x<e?t.x:e),0)),((e,t)=>{let n=document.querySelector("main");n&&e!==t&&(n.scrollLeft+=(X.value+8)*(t-e))}));const H=s(!1),{x:M,y:V}=u({type:"client"}),{element:W}=c({x:M,y:V}),{pressed:Z}=i(),{vibrate:B}=l({pattern:[300,100,300]}),D=s(!1),G=s(!1);function K(e){G.value||D.value&&"mouse"===e.pointerType||(H.value=!0)}function P(e){return!(!e.dataset.x||!e.dataset.y)}function Q(e){if(P(e)){return{x:+e.dataset.x,y:+e.dataset.y}}}function R(e){if(e.target&&P(e.target)){const{x:t,y:n}=Q(e.target);A(t,n)}}function U(e,t){const n=e.x-t.x,a=e.y-t.y;return Math.hypot(n,a)}o(H,(e=>{if(e&&W.value&&P(W.value)){let{x:e,y:t}=Q(W.value);A(e,t),B()}E.value=e})),o(Z,(()=>{D.value=H.value=!1})),o(W,(()=>{!Z.value&&H.value||(D.value=!0)})),o(W,(e=>{if(H.value&&e&&P(e)){let{x:t,y:n}=Q(e);A(t,n)}})),o(F,(()=>{F&&(F.value=!1,_.length=0)}));let ee={x:0,y:0},te={x:0,y:0};function ne(e){2===e.touches.length&&(G.value=!0,ee.x=e.touches[0].clientX,ee.y=e.touches[0].clientY,te.x=e.touches[1].clientX,te.y=e.touches[1].clientY)}function ae(e){if(2===e.touches.length){let t=(U({x:e.touches[0].clientX,y:e.touches[0].clientY},{x:e.touches[1].clientX,y:e.touches[1].clientY})-U(ee,te))/200;X.value+=t,X.value<1&&(X.value=1)}}return(e,t)=>{const n=T;return y((m(),f("div",{class:"container",style:p({gridTemplateColumns:`repeat(${v(z).length}, auto)`,"--width":v(X)+"px","--height":v(X)+"px"}),onContextmenu:t[0]||(t[0]=h((()=>{}),["prevent"])),onClick:R,onTouchstart:h(ne,["prevent"]),onTouchmove:h(ae,["prevent"]),onTouchend:t[1]||(t[1]=h((e=>G.value=!1),["prevent"]))},[(m(!0),f(x,null,d(v($),(e=>(m(),f(x,{key:e},[(m(!0),f(x,null,d(v(z),(t=>(m(),f("div",{key:t,"data-x":t,"data-y":e,class:g({true:j(t,e)}),style:p(v(q)&&!v(G)?{}:{transition:"none"})},null,14,N)))),128))],64)))),128))],44,J)),[[n,K]])}}});export{O as _};
