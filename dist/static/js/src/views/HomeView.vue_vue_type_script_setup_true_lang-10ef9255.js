import{d as e,s as t,V as a,W as n,r as u,X as o,Y as r,Z as s,_ as l,$ as c,a0 as i,a1 as f,q as y,F as v,a2 as x,a as d,a3 as p,a4 as h,a5 as m,o as g,a6 as S,a7 as w}from"../../vendor-e415ac2b.js";import{u as T}from"../stores/config-dc142c46.js";import{u as k}from"../stores/temp-68e4ff78.js";const J=["data-x","data-y"],N=e({__name:"HomeView",setup(e){const{col:N,row:O,divSize:b,updateSpeed:q,enabledTransition:F}=t(T());let{isStart:X,isClean:Y}=t(k()),A=a([]);function C(e,t){return A.find((a=>a.x===e&&a.y===t))}function E(e,t,a=!C(e,t)){!!C(e,t)?a||A.splice(function(e,t){return A.findIndex((a=>a.x===e&&a.y===t))}(e,t),1):a&&A.push({x:e,y:t})}const{workerFn:_}=n((e=>{const t=JSON.parse(e);function*a(...e){if(1===e.length)for(const t of e[0])yield[t];else{const t=[],n=e[0][0];for(const u of a(...e.slice(1)))t.push(u),yield[n,...u];for(const a of e[0].slice(1))for(const e of t)yield[a,...e]}}function n(e,t,a){return u(t,a).map((({x:t,y:a})=>function(t,a){return e.find((e=>e.x===t&&e.y===a))}(t,a)))}function u(e,t){return[...a([-1,0,1],[-1,0,1])].filter((([e,t])=>0!==e||0!==t)).map((([a,n])=>({x:e+a,y:t+n})))}const o=[],r=[];var s;return t.forEach((({x:e,y:t})=>{[{x:e,y:t},...u(e,t)].forEach((e=>{r.push(e)}))})),(s=r,s.filter(((e,t,a)=>a.findIndex((t=>{return a=e,n=t,JSON.stringify(a)===JSON.stringify(n);var a,n}))===t))).forEach((({x:e,y:a})=>{const u=function(e,a){return t.find((t=>t.x===e&&t.y===a))}(e,a);switch(n(t,e,a).reduce(((e,t)=>e+ +!!t),0)){case 2:break;case 3:u||o.push({x:e,y:a});break;default:u&&o.push({x:e,y:a})}})),JSON.stringify(o)}));let j=u(null);function z(e,t){return Array(t-e).fill(e).map(((e,t)=>e+t))}o(X,(()=>{if(X.value){let e=performance.now();j.value=requestAnimationFrame((async function t(a){X.value&&(a-e>=q.value&&(e=a,JSON.parse(await _(JSON.stringify(A))).forEach((({x:e,y:t})=>{E(e,t)}))),requestAnimationFrame(t))}))}}));const D=r((()=>{let e=A.reduce(((e,t)=>t.y>e?t.y:e),O.value-1)+1;return z(A.reduce(((e,t)=>t.y<e?t.y:e),0),e)})),I=r((()=>{let e=A.reduce(((e,t)=>t.x>e?t.x:e),N.value-1)+1;return z(A.reduce(((e,t)=>t.x<e?t.x:e),0),e)}));o((()=>D.value[0]),(async(e,t)=>{let a=document.querySelector("main");a&&e!==t&&0===a.scrollTop&&(await S(),a.scrollTop+=(b.value+8)*(t-e))})),o((()=>I.value[0]),((e,t)=>{let a=document.querySelector("main");a&&e!==t&&(a.scrollLeft+=(b.value+8)*(t-e))}));const V=u(!1),{x:$,y:H}=s({type:"client"}),{element:L}=l({x:$,y:H}),{pressed:M}=c(),{vibrate:W}=i({pattern:[300,100,300]}),Z=u(!1),B=u(!1);function G(e){B.value||Z.value&&"mouse"===e.pointerType||(V.value=!0)}function K(e){return!(!e.dataset.x||!e.dataset.y)}function P(e){if(K(e)){return{x:+e.dataset.x,y:+e.dataset.y}}}function Q(e){if(e.target&&K(e.target)){const{x:t,y:a}=P(e.target);E(t,a)}}function R(e,t){const a=e.x-t.x,n=e.y-t.y;return Math.hypot(a,n)}o(V,(e=>{if(e&&L.value&&K(L.value)){let{x:e,y:t}=P(L.value);E(e,t),W()}})),o(M,(()=>{Z.value=V.value=!1})),o(L,(()=>{!M.value&&V.value||(Z.value=!0)})),o(L,(e=>{if(V.value&&e&&K(e)){let{x:t,y:a}=P(e);E(t,a)}})),o(Y,(()=>{Y&&(Y.value=!1,j.value&&(cancelAnimationFrame(j.value),j.value=null),A.length=0)}));let U={x:0,y:0},ee={x:0,y:0};function te(e){2===e.touches.length&&(B.value=!0,U.x=e.touches[0].clientX,U.y=e.touches[0].clientY,ee.x=e.touches[1].clientX,ee.y=e.touches[1].clientY)}function ae(e){if(2===e.touches.length){e.preventDefault();let t=(R({x:e.touches[0].clientX,y:e.touches[0].clientY},{x:e.touches[1].clientX,y:e.touches[1].clientY})-R(U,ee))/200;b.value+=t,b.value<1&&(b.value=1)}else V.value&&e.preventDefault()}return(e,t)=>{const a=w;return f((g(),y("div",{class:p(["container",{transition:d(F),zoom:d(B)}]),style:h({gridTemplateColumns:`repeat(${d(I).length}, auto)`,"--width":d(b)+"px","--height":d(b)+"px"}),onContextmenu:t[0]||(t[0]=m((()=>{}),["prevent"])),onClick:Q,onTouchstart:te,onTouchmove:ae,onTouchend:t[1]||(t[1]=e=>B.value=!1)},[(g(!0),y(v,null,x(d(D),(e=>(g(),y(v,{key:e},[(g(!0),y(v,null,x(d(I),(t=>(g(),y("div",{key:t,"data-x":t,"data-y":e,class:p({true:C(t,e)})},null,10,J)))),128))],64)))),128))],38)),[[a,G]])}}});export{N as _};
